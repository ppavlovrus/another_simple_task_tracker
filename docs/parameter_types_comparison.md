# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤: –æ–±—ã—á–Ω—ã–µ vs Dependency Injection

## –¢–≤–æ—è –∞–Ω–∞–ª–æ–≥–∏—è - –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è!

–î–∞, —Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–Ω–∏–º–∞–µ—à—å! `conn: Annotated[asyncpg.Connection, Depends(get_db_connection)]` - —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä —Ñ—É–Ω–∫—Ü–∏–∏, –∫–∞–∫ –∏ `name: str`. –ò –¥–∞, –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã, –∫–∞–∫ —É —Å—Ç—Ä–æ–∫–∏.

–ù–æ –µ—Å—Ç—å **–≤–∞–∂–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ** - FastAPI –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö **–ø–æ-—Ä–∞–∑–Ω–æ–º—É**!

---

## –ê–Ω–∞–ª–æ–≥–∏—è —Å –æ–±—ã—á–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏

### –û–±—ã—á–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä (—Å—Ç—Ä–æ–∫–∞):

```python
def greet(name: str):
    # name - —ç—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä —Ç–∏–ø–∞ str
    # –ú–æ–∂–µ–º –≤—ã–∑—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã —Å—Ç—Ä–æ–∫–∏
    upper_name = name.upper()  # –í—ã–∑—ã–≤–∞–µ–º –º–µ—Ç–æ–¥ —Å—Ç—Ä–æ–∫–∏
    return f"Hello, {upper_name}!"
```

### Dependency –ø–∞—Ä–∞–º–µ—Ç—Ä (—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ):

```python
async def create_task(
    conn: Annotated[asyncpg.Connection, Depends(get_db_connection)],
):
    # conn - —ç—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä —Ç–∏–ø–∞ asyncpg.Connection
    # –ú–æ–∂–µ–º –≤—ã–∑—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    row = await conn.fetchrow("SELECT ...")  # –í—ã–∑—ã–≤–∞–µ–º –º–µ—Ç–æ–¥ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
    return row
```

**–° —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è - –æ–¥–∏–Ω–∞–∫–æ–≤–æ!** –û–±–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞:
- –ò–º–µ—é—Ç —Ç–∏–ø
- –ú–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã
- –ü–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —Ñ—É–Ω–∫—Ü–∏—é

---

## –ù–æ –µ—Å—Ç—å –≤–∞–∂–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ!

### –ö–∞–∫ FastAPI –ø–æ–ª—É—á–∞–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞?

FastAPI **–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–∏–ø –ø–∞—Ä–∞–º–µ—Ç—Ä–∞** –∏ —Ä–µ—à–∞–µ—Ç, **–æ—Ç–∫—É–¥–∞ –≤–∑—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ**:

#### 1. –û–±—ã—á–Ω—ã–π —Ç–∏–ø (`str`, `int`, `bool`) ‚Üí Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–ª–∏ Path –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

```python
@app.get("/users/{user_id}")
async def get_user(
    user_id: int,        # ‚Üê Path –ø–∞—Ä–∞–º–µ—Ç—Ä (–∏–∑ URL)
    name: str,           # ‚Üê Query –ø–∞—Ä–∞–º–µ—Ç—Ä (–∏–∑ ?name=value)
    active: bool = True, # ‚Üê Query –ø–∞—Ä–∞–º–µ—Ç—Ä —Å –¥–µ—Ñ–æ–ª—Ç–æ–º
):
    # FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç:
    # - user_id –∏–∑ URL: /users/123 ‚Üí user_id = 123
    # - name –∏–∑ query: /users/123?name=John ‚Üí name = "John"
    # - active –∏–∑ query: /users/123?active=false ‚Üí active = False
    pass
```

**FastAPI –¥–µ–ª–∞–µ—Ç:**
```python
# –ü—Å–µ–≤–¥–æ–∫–æ–¥:
user_id = int(request.path_params["user_id"])  # –ò–∑ URL
name = request.query_params.get("name")         # –ò–∑ ?name=...
active = request.query_params.get("active", True)
```

#### 2. Pydantic –º–æ–¥–µ–ª—å ‚Üí Body –∑–∞–ø—Ä–æ—Å–∞

```python
@app.post("/tasks")
async def create_task(
    task: TaskCreate,  # ‚Üê Body –ø–∞—Ä–∞–º–µ—Ç—Ä (–∏–∑ JSON)
):
    # FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–∞—Ä—Å–∏—Ç JSON:
    # POST /tasks
    # Body: {"title": "Task 1", ...}
    # ‚Üí task = TaskCreate(title="Task 1", ...)
    pass
```

**FastAPI –¥–µ–ª–∞–µ—Ç:**
```python
# –ü—Å–µ–≤–¥–æ–∫–æ–¥:
task = TaskCreate.parse_obj(request.json)  # –ò–∑ JSON body
```

#### 3. `Depends(...)` ‚Üí Dependency Injection

```python
@app.post("/tasks")
async def create_task(
    conn: Annotated[asyncpg.Connection, Depends(get_db_connection)],
):
    # FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é:
    # conn = await get_db_connection()
    pass
```

**FastAPI –¥–µ–ª–∞–µ—Ç:**
```python
# –ü—Å–µ–≤–¥–æ–∫–æ–¥:
conn = await get_db_connection()  # –í—ã–∑—ã–≤–∞–µ—Ç dependency —Ñ—É–Ω–∫—Ü–∏—é
```

---

## –ß—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏ —É–±—Ä–∞—Ç—å `Depends()`?

–ü–æ–ø—Ä–æ–±—É–µ–º:

```python
@app.post("/tasks")
async def create_task(
    task: TaskCreate,
    conn: asyncpg.Connection,  # ‚ùå –ù–µ—Ç Depends()!
) -> TaskResponse:
    row = await conn.fetchrow("INSERT ...")
    return TaskResponse(...)
```

**–ß—Ç–æ —Å–¥–µ–ª–∞–µ—Ç FastAPI?**

FastAPI —É–≤–∏–¥–∏—Ç `conn: asyncpg.Connection` –∏ –ø–æ–¥—É–º–∞–µ—Ç:
> "–≠—Ç–æ –Ω–µ Pydantic –º–æ–¥–µ–ª—å, –Ω–µ Depends, –Ω–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ç–∏–ø... –û—Ç–∫—É–¥–∞ –≤–∑—è—Ç—å `asyncpg.Connection`?"

FastAPI –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –Ω–∞–π—Ç–∏ `conn` –≤:
1. Path –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö (`/tasks/{conn}`) - –Ω–µ—Ç
2. Query –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö (`?conn=...`) - –Ω–µ—Ç
3. Body - –Ω–µ—Ç

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
```
422 Unprocessable Entity
{
  "detail": [
    {
      "type": "missing",
      "loc": ["body", "conn"],
      "msg": "Field required"
    }
  ]
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** FastAPI –Ω–µ –∑–Ω–∞–µ—Ç, **–∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å** `asyncpg.Connection`. –≠—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ–π —Ç–∏–ø, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –∏–∑ –∑–∞–ø—Ä–æ—Å–∞!

---

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –æ—Ç–∫—É–¥–∞ FastAPI –±–µ—Ä–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è?

| –¢–∏–ø –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ | –û—Ç–∫—É–¥–∞ FastAPI –±–µ—Ä–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|--------------|-------------------------------|--------|
| `str`, `int`, `bool` | Query –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–ª–∏ Path –ø–∞—Ä–∞–º–µ—Ç—Ä—ã | `name: str` ‚Üí `?name=John` |
| Pydantic –º–æ–¥–µ–ª—å | Body –∑–∞–ø—Ä–æ—Å–∞ (JSON) | `task: TaskCreate` ‚Üí `{"title": "Task 1"}` |
| `Depends(...)` | –í—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é | `conn: Depends(get_db_connection)` ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç `get_db_connection()` |
| `Header(...)` | HTTP –∑–∞–≥–æ–ª–æ–≤–∫–∏ | `token: str = Header(...)` ‚Üí `Authorization: Bearer token` |
| `Cookie(...)` | Cookies | `session: str = Cookie(...)` ‚Üí –∏–∑ cookies |

---

## –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è: –∫–∞–∫ FastAPI –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  –ó–∞–ø—Ä–æ—Å: POST /tasks                                    ‚îÇ
‚îÇ  Body: {"title": "Task 1", "description": "..."}       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  FastAPI –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ñ—É–Ω–∫—Ü–∏–∏:                 ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  async def create_task(                                 ‚îÇ
‚îÇ      task: TaskCreate,                                  ‚îÇ
‚îÇ      conn: Annotated[..., Depends(get_db_connection)], ‚îÇ
‚îÇ  ):                                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  FastAPI –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫ –∫–∞–∂–¥–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞:          ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  1. task: TaskCreate                                    ‚îÇ
‚îÇ     ‚Üí –≠—Ç–æ Pydantic –º–æ–¥–µ–ª—å                                ‚îÇ
‚îÇ     ‚Üí –ë–µ—Ä–µ–º –∏–∑ Body (JSON)                              ‚îÇ
‚îÇ     ‚Üí task = TaskCreate.parse_obj(request.json)         ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  2. conn: Depends(get_db_connection)                    ‚îÇ
‚îÇ     ‚Üí –≠—Ç–æ Dependency                                     ‚îÇ
‚îÇ     ‚Üí –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é                                  ‚îÇ
‚îÇ     ‚Üí conn = await get_db_connection()                  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                        ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  FastAPI –≤—ã–∑—ã–≤–∞–µ—Ç endpoint:                              ‚îÇ
‚îÇ                                                          ‚îÇ
‚îÇ  result = await create_task(                             ‚îÇ
‚îÇ      task=TaskCreate(...),  ‚Üê –ò–∑ Body                   ‚îÇ
‚îÇ      conn=Connection(...),  ‚Üê –ò–∑ dependency             ‚îÇ
‚îÇ  )                                                       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

```python
@app.post("/tasks/{task_id}/comments")
async def create_comment(
    # 1. Path –ø–∞—Ä–∞–º–µ—Ç—Ä (–∏–∑ URL)
    task_id: int,
    
    # 2. Query –ø–∞—Ä–∞–º–µ—Ç—Ä (–∏–∑ ?user_id=123)
    user_id: int,
    
    # 3. Header –ø–∞—Ä–∞–º–µ—Ç—Ä (–∏–∑ HTTP –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤)
    authorization: str = Header(..., alias="Authorization"),
    
    # 4. Body –ø–∞—Ä–∞–º–µ—Ç—Ä (–∏–∑ JSON)
    comment: CommentCreate,
    
    # 5. Dependency (–≤—ã–∑—ã–≤–∞–µ—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏—è)
    conn: Annotated[asyncpg.Connection, Depends(get_db_connection)],
    
    # 6. –ï—â–µ –æ–¥–Ω–∞ dependency (–º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥—É—é)
    user: Annotated[User, Depends(get_current_user)],
) -> CommentResponse:
    # –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–æ—Å—Ç—É–ø–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!
    row = await conn.fetchrow(
        "INSERT INTO comments ...",
        task_id,      # –ò–∑ path
        user_id,      # –ò–∑ query
        user.id,      # –ò–∑ dependency
        comment.text, # –ò–∑ body
    )
    return CommentResponse(...)
```

**FastAPI –æ–±—Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫:**

```python
# –ü—Å–µ–≤–¥–æ–∫–æ–¥ —Ç–æ–≥–æ, —á—Ç–æ –¥–µ–ª–∞–µ—Ç FastAPI:

# 1. Path –ø–∞—Ä–∞–º–µ—Ç—Ä
task_id = int(request.path_params["task_id"])

# 2. Query –ø–∞—Ä–∞–º–µ—Ç—Ä
user_id = int(request.query_params["user_id"])

# 3. Header –ø–∞—Ä–∞–º–µ—Ç—Ä
authorization = request.headers["Authorization"]

# 4. Body –ø–∞—Ä–∞–º–µ—Ç—Ä
comment = CommentCreate.parse_obj(request.json)

# 5. Dependency
conn = await get_db_connection()

# 6. Dependency (–º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ dependencies)
user = await get_current_user(authorization=authorization, conn=conn)

# –í—ã–∑–æ–≤ endpoint
result = await create_comment(
    task_id=task_id,
    user_id=user_id,
    authorization=authorization,
    comment=comment,
    conn=conn,
    user=user,
)
```

---

## –ü–æ—á–µ–º—É `Depends()` –Ω—É–∂–µ–Ω –¥–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ç–∏–ø–æ–≤?

### –ü—Ä–æ–±–ª–µ–º–∞ —Å `asyncpg.Connection`:

```python
# ‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
async def create_task(
    conn: asyncpg.Connection,  # FastAPI –Ω–µ –∑–Ω–∞–µ—Ç, –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å —ç—Ç–æ!
):
    pass
```

**–ü–æ—á–µ–º—É –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- `asyncpg.Connection` - —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ–π —Ç–∏–ø (–Ω–µ `str`, `int`)
- FastAPI –Ω–µ –º–æ–∂–µ—Ç —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å –µ–≥–æ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞
- FastAPI –Ω–µ –∑–Ω–∞–µ—Ç, –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ë–î

### –†–µ—à–µ–Ω–∏–µ - `Depends()`:

```python
# ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç:
async def create_task(
    conn: Annotated[asyncpg.Connection, Depends(get_db_connection)],
):
    pass
```

**–ü–æ—á–µ–º—É —Ä–∞–±–æ—Ç–∞–µ—Ç:**
- `Depends(get_db_connection)` –≥–æ–≤–æ—Ä–∏—Ç FastAPI: "–í—ã–∑–æ–≤–∏ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ"
- FastAPI –≤—ã–∑—ã–≤–∞–µ—Ç `get_db_connection()` –∏ –ø–æ–ª—É—á–∞–µ—Ç `asyncpg.Connection`
- –ü–µ—Ä–µ–¥–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä `conn`

---

## –ê–Ω–∞–ª–æ–≥–∏—è –∏–∑ –∂–∏–∑–Ω–∏

### –û–±—ã—á–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä (`str`):

```
–¢—ã: "–ú–Ω–µ –Ω—É–∂–Ω–∞ —Å—Ç—Ä–æ–∫–∞"
FastAPI: "–û–∫–µ–π, –≤–æ–∑—å–º—É –∏–∑ –∑–∞–ø—Ä–æ—Å–∞" ‚Üí "Hello"
–¢—ã: "–°–ø–∞—Å–∏–±–æ!" ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—à—å "Hello"
```

### Dependency (`Depends(...)`):

```
–¢—ã: "–ú–Ω–µ –Ω—É–∂–Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ë–î"
FastAPI: "–û–∫–µ–π, –≤—ã–∑–æ–≤—É —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–∑–¥–∞—Å—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ"
       ‚Üí –≤—ã–∑—ã–≤–∞–µ—Ç get_db_connection()
       ‚Üí –ø–æ–ª—É—á–∞–µ—Ç Connection
–¢—ã: "–°–ø–∞—Å–∏–±–æ!" ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—à—å Connection
```

---

## –†–µ–∑—é–º–µ

### –ß—Ç–æ —Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–Ω—è–ª:

1. ‚úÖ `conn` - —ç—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä —Ñ—É–Ω–∫—Ü–∏–∏, –∫–∞–∫ –∏ `name: str`
2. ‚úÖ –ú–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã: `conn.fetchrow()`, –∫–∞–∫ `name.upper()`
3. ‚úÖ –¢–∏–ø –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —á—Ç–æ –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å —Å –æ–±—ä–µ–∫—Ç–æ–º

### –í–∞–∂–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ:

1. üîë **–û—Ç–∫—É–¥–∞ –±–µ—Ä–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ:**
   - `name: str` ‚Üí FastAPI –±–µ—Ä–µ—Ç –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ (query/path)
   - `conn: Depends(...)` ‚Üí FastAPI –≤—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é

2. üîë **–î–ª—è –ø—Ä–æ—Å—Ç—ã—Ö —Ç–∏–ø–æ–≤** (`str`, `int`) FastAPI –∑–Ω–∞–µ—Ç, –∫–∞–∫ —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å
3. üîë **–î–ª—è —Å–ª–æ–∂–Ω—ã—Ö —Ç–∏–ø–æ–≤** (`asyncpg.Connection`) –Ω—É–∂–µ–Ω `Depends()`, —á—Ç–æ–±—ã —Å–∫–∞–∑–∞—Ç—å FastAPI, –∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ

### –ò—Ç–æ–≥:

–¢–≤–æ—è –∞–Ω–∞–ª–æ–≥–∏—è –≤–µ—Ä–Ω–∞! –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –ø–∞—Ä–∞–º–µ—Ç—Ä —Ñ—É–Ω–∫—Ü–∏–∏ —Å —Ç–∏–ø–æ–º, –∏ –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å –º–µ—Ç–æ–¥—ã. –ù–æ `Depends()` - —ç—Ç–æ **–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è FastAPI**, –æ—Ç–∫—É–¥–∞ –≤–∑—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ FastAPI –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫ —Å–æ–∑–¥–∞—Ç—å `asyncpg.Connection` –∏–∑ –∑–∞–ø—Ä–æ—Å–∞.

---

## –í–∏–∑—É–∞–ª—å–Ω–∞—è —Å—Ö–µ–º–∞

```
–ü–∞—Ä–∞–º–µ—Ç—Ä —Ñ—É–Ω–∫—Ü–∏–∏:
‚îú‚îÄ –¢–∏–ø (asyncpg.Connection) ‚Üí –ß—Ç–æ —ç—Ç–æ –∑–∞ –æ–±—ä–µ–∫—Ç
‚îÇ  ‚îî‚îÄ –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–∏–µ –º–µ—Ç–æ–¥—ã –º–æ–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å
‚îÇ
‚îî‚îÄ –ò—Å—Ç–æ—á–Ω–∏–∫ –∑–Ω–∞—á–µ–Ω–∏—è (Depends(...)) ‚Üí –û—Ç–∫—É–¥–∞ –≤–∑—è—Ç—å –æ–±—ä–µ–∫—Ç
   ‚îî‚îÄ –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫ FastAPI –ø–æ–ª—É—á–∏—Ç –∑–Ω–∞—á–µ–Ω–∏–µ
```

**–û–±–∞ –≤–∞–∂–Ω—ã:**
- **–¢–∏–ø** - –¥–ª—è –Ω–∞—Å (—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤) –∏ type checkers
- **Depends** - –¥–ª—è FastAPI (–∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ)

---

–≠—Ç–æ –∫–∞–∫ —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É:
- "–ú–Ω–µ –Ω—É–∂–Ω–∞ —Å—Ç—Ä–æ–∫–∞" (FastAPI –∑–Ω–∞–µ—Ç, –∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å –∏–∑ –∑–∞–ø—Ä–æ—Å–∞)
- "–ú–Ω–µ –Ω—É–∂–Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –ë–î" (FastAPI –Ω–µ –∑–Ω–∞–µ—Ç, –Ω—É–∂–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —á–µ—Ä–µ–∑ `Depends()`)

–¢–≤–æ—è –∞–Ω–∞–ª–æ–≥–∏—è –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è! üéØ

